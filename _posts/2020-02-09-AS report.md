---
title: 傾向スコアを使った因果推論の分析例
output: 
  html_document: 
    df_print: kable
layout: post
topic: analysis
---

授業のレポートで因果推論による効果測定を行ったものをほぼそのまま投稿.  
Rmarkdownをjekyllで投稿する機能のテストを兼ねて.  
データを `./data/` の中に入れればそのまま実行可能のはず.  

* 
{:toc}


{% highlight r %}
knitr::opts_chunk$set(echo = TRUE, include = TRUE, warning=FALSE, message=FALSE)
library(tidyverse)
library(skimr)
library(magrittr)
library(pROC)
library(modelsummary)
{% endhighlight %}

# 概要


データ  

> Bank Marketing Data Set  
[Moro et al., 2014] S. Moro, P. Cortez and P. Rita. A Data-Driven Approach to Predict the Success of Bank Telemarketing. Decision Support Systems, Elsevier, 62:22-31, June 2014  
http://archive.ics.uci.edu/ml/datasets/Bank+Marketing  

仮説

> 銀行の電話営業による定期預金の成約確率は, 接触方法が固定電話か携帯電話かによって異なる.

分析方法

> 傾向スコアを利用した因果推論

結果

> 1%の有意水準で携帯電話での接触の方が成約確率が高く, オッズ比は2.46と推定された.

# データ理解


{% highlight r %}
dat <- read_delim("./data/bank-additional/bank-additional-full.csv",delim = ";", quote = '"')
dat %>% skim()
{% endhighlight %}


Table: Data summary

|                         |           |
|:------------------------|:----------|
|Name                     |Piped data |
|Number of rows           |41188      |
|Number of columns        |21         |
|_______________________  |           |
|Column type frequency:   |           |
|character                |11         |
|numeric                  |10         |
|________________________ |           |
|Group variables          |None       |


**Variable type: character**

|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|
|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|
|job           |         0|             1|   6|  13|     0|       12|          0|
|marital       |         0|             1|   6|   8|     0|        4|          0|
|education     |         0|             1|   7|  19|     0|        8|          0|
|default       |         0|             1|   2|   7|     0|        3|          0|
|housing       |         0|             1|   2|   7|     0|        3|          0|
|loan          |         0|             1|   2|   7|     0|        3|          0|
|contact       |         0|             1|   8|   9|     0|        2|          0|
|month         |         0|             1|   3|   3|     0|       10|          0|
|day_of_week   |         0|             1|   3|   3|     0|        5|          0|
|poutcome      |         0|             1|   7|  11|     0|        3|          0|
|y             |         0|             1|   2|   3|     0|        2|          0|


**Variable type: numeric**

|skim_variable  | n_missing| complete_rate|    mean|     sd|      p0|     p25|     p50|     p75|    p100|hist  |
|:--------------|---------:|-------------:|-------:|------:|-------:|-------:|-------:|-------:|-------:|:-----|
|age            |         0|             1|   40.02|  10.42|   17.00|   32.00|   38.00|   47.00|   98.00|▅▇▃▁▁ |
|duration       |         0|             1|  258.29| 259.28|    0.00|  102.00|  180.00|  319.00| 4918.00|▇▁▁▁▁ |
|campaign       |         0|             1|    2.57|   2.77|    1.00|    1.00|    2.00|    3.00|   56.00|▇▁▁▁▁ |
|pdays          |         0|             1|  962.48| 186.91|    0.00|  999.00|  999.00|  999.00|  999.00|▁▁▁▁▇ |
|previous       |         0|             1|    0.17|   0.49|    0.00|    0.00|    0.00|    0.00|    7.00|▇▁▁▁▁ |
|emp.var.rate   |         0|             1|    0.08|   1.57|   -3.40|   -1.80|    1.10|    1.40|    1.40|▁▃▁▁▇ |
|cons.price.idx |         0|             1|   93.58|   0.58|   92.20|   93.08|   93.75|   93.99|   94.77|▁▆▃▇▂ |
|cons.conf.idx  |         0|             1|  -40.50|   4.63|  -50.80|  -42.70|  -41.80|  -36.40|  -26.90|▅▇▁▇▁ |
|euribor3m      |         0|             1|    3.62|   1.73|    0.63|    1.34|    4.86|    4.96|    5.04|▅▁▁▁▇ |
|nr.employed    |         0|             1| 5167.04|  72.25| 4963.60| 5099.10| 5191.00| 5228.10| 5228.10|▁▁▃▁▇ |



{% highlight r %}
dat %>% head()
{% endhighlight %}



{% highlight text %}
## # A tibble: 6 x 21
##     age job   marital education default housing loan  contact month day_of_week
##   <dbl> <chr> <chr>   <chr>     <chr>   <chr>   <chr> <chr>   <chr> <chr>      
## 1    56 hous… married basic.4y  no      no      no    teleph… may   mon        
## 2    57 serv… married high.sch… unknown no      no    teleph… may   mon        
## 3    37 serv… married high.sch… no      yes     no    teleph… may   mon        
## 4    40 admi… married basic.6y  no      no      no    teleph… may   mon        
## 5    56 serv… married high.sch… no      no      yes   teleph… may   mon        
## 6    45 serv… married basic.9y  unknown no      no    teleph… may   mon        
## # … with 11 more variables: duration <dbl>, campaign <dbl>, pdays <dbl>,
## #   previous <dbl>, poutcome <chr>, emp.var.rate <dbl>, cons.price.idx <dbl>,
## #   cons.conf.idx <dbl>, euribor3m <dbl>, nr.employed <dbl>, y <chr>
{% endhighlight %}


{% highlight r %}
dat <- dat %>% 
    mutate_at(vars(job,marital,education,default,housing,loan,month,day_of_week,poutcome), 
              funs(as.factor)) %>% 
    mutate(contact = (contact == "cellular") %>% as.integer(),
           y = (y == "yes") %>% as.integer())
{% endhighlight %}

使用するデータは [Moro et al., 2014] によって 2008年5月から2013年6月までにポルトガルの銀行から収集された, 合計52,944件の電話営業による定期預金契約の成約結果のデータである. 

## 変数の理解

データには, 以下の変数が存在する.  
今回の分析では目的変数は `y` , 介入変数は `contact` , その他の変数のうち `duration` を除いたものを交絡変数とする.  

1. age : 年齢
2. job : 職業   
    "admin.","blue-collar","entrepreneur","housemaid","management","retired","self-employed","services","student","technician","unemployed","unknown"
3. marital : 結婚状況   
    "divorced","married","single","unknown"
        note: "divorced" means divorced or widowed
4. education : 最終学歴 
    "basic.4y","basic.6y","basic.9y","high.school","illiterate","professional.course","university.degree","unknown"
5. default : 債務不履行か   
    "no","yes","unknown"
6. housing : 住宅ローンありか   
    "no","yes","unknown"
7. loan : 個人ローンありか  
    "no","yes","unknown"
8. contact : 接触のコミュニケーション方法   
    "cellular","telephone"
9. month : 当年の直近の接触月   
    "jan", "feb", "mar", ..., "nov", "dec"
10. day_of_week : 当週の直近の接触曜日  
    "mon","tue","wed","thu","fri"
11. duration : 直近の接触時間(秒)   
    電話営業の会話時間は成約結果に依存するため, モデルに含めてはいけない
12. campaign : 当顧客への当キャンペーン中の接触回数
13. pdays : 前回のキャンペーンでの当顧客への直近の接触からの日数
14. previous : 当顧客への当キャンペーン以前の接触回数
15. poutcome : 前回のマーケティングキャンペーンの結果   
    "failure","nonexistent","success"
16. emp.var.rate : 四半期 Employment variation rate
17. cons.price.idx : 月間消費者物価指数
18. cons.conf.idx : 月間消費者信頼感指数
19. euribor3m : 日別3ヶ月ユーリボー指標金利
20. nr.employed : 四半期被雇用者数
21. y : 定期預金の有無

## 生データの確認

データセットからランダムに10レコードを抽出し, 以下に表示する. 


{% highlight r %}
sample_10 <- dat %>% 
    sample_n(10)
sample_10 %>% dplyr::select(1:10)
{% endhighlight %}



{% highlight text %}
## # A tibble: 10 x 10
##      age job   marital education default housing loan  contact month day_of_week
##    <dbl> <fct> <fct>   <fct>     <fct>   <fct>   <fct>   <int> <fct> <fct>      
##  1    35 serv… married high.sch… no      yes     no          1 apr   thu        
##  2    57 admi… divorc… basic.9y  no      yes     yes         1 jul   mon        
##  3    51 mana… divorc… universi… no      no      no          1 jul   wed        
##  4    54 blue… married basic.4y  no      no      no          1 sep   fri        
##  5    25 blue… single  basic.9y  no      yes     yes         1 jul   wed        
##  6    33 tech… single  universi… no      no      no          1 may   fri        
##  7    32 serv… single  basic.6y  no      no      no          0 may   fri        
##  8    42 unkn… single  universi… unknown yes     no          1 jul   mon        
##  9    34 admi… single  universi… no      no      no          1 nov   fri        
## 10    25 admi… single  basic.9y  no      yes     no          1 jul   thu
{% endhighlight %}



{% highlight r %}
sample_10 %>% dplyr::select(11:20)
{% endhighlight %}



{% highlight text %}
## # A tibble: 10 x 10
##    duration campaign pdays previous poutcome emp.var.rate cons.price.idx
##       <dbl>    <dbl> <dbl>    <dbl> <fct>           <dbl>          <dbl>
##  1      466        2   999        2 failure          -1.8           93.1
##  2      518        4   999        0 nonexis…          1.4           93.9
##  3      166        7   999        1 failure          -2.9           92.5
##  4       49        2   999        1 failure          -3.4           92.4
##  5      322        2   999        0 nonexis…          1.4           93.9
##  6      204        3   999        1 failure          -1.8           92.9
##  7      361        1   999        0 nonexis…          1.1           94.0
##  8       93        3   999        0 nonexis…          1.4           93.9
##  9      229        3   999        0 nonexis…         -0.1           93.2
## 10      115        4   999        0 nonexis…          1.4           93.9
## # … with 3 more variables: cons.conf.idx <dbl>, euribor3m <dbl>,
## #   nr.employed <dbl>
{% endhighlight %}



{% highlight r %}
sample_10 %>% dplyr::select(21)
{% endhighlight %}



{% highlight text %}
## # A tibble: 10 x 1
##        y
##    <int>
##  1     0
##  2     0
##  3     0
##  4     0
##  5     0
##  6     0
##  7     0
##  8     0
##  9     0
## 10     0
{% endhighlight %}

## 分布と相関の確認

データの全容を把握するため, 各変数の分布と目的変数との相関を確認する. 

### 分布の確認

それぞれのカテゴリカル変数について, カテゴリ毎のレコード数を表示する.  
特に留意すべき点として, まず介入変数とする `contact` は値が `cellular` である時に1とするように変数変換を行なっており, またデータの偏り桁が同程度のため大きくない. 目的変数 `y` は値が `yes` ある時に1とするように変数変換を行なっており, またデータの偏りは桁が異なるため大きいと判断される. 


{% highlight r %}
dist_cat <- function(x, col){
    col <- substitute(col)
    out<- x %>% 
        group_by(!!col) %>% 
        summarise(N=n(), .groups="drop")
    return(out)
}
dat %>% dist_cat(job)
{% endhighlight %}



{% highlight text %}
## # A tibble: 12 x 2
##    job               N
##    <fct>         <int>
##  1 admin.        10422
##  2 blue-collar    9254
##  3 entrepreneur   1456
##  4 housemaid      1060
##  5 management     2924
##  6 retired        1720
##  7 self-employed  1421
##  8 services       3969
##  9 student         875
## 10 technician     6743
## 11 unemployed     1014
## 12 unknown         330
{% endhighlight %}



{% highlight r %}
dat %>% dist_cat(marital)
{% endhighlight %}



{% highlight text %}
## # A tibble: 4 x 2
##   marital      N
##   <fct>    <int>
## 1 divorced  4612
## 2 married  24928
## 3 single   11568
## 4 unknown     80
{% endhighlight %}



{% highlight r %}
dat %>% dist_cat(education)
{% endhighlight %}



{% highlight text %}
## # A tibble: 8 x 2
##   education               N
##   <fct>               <int>
## 1 basic.4y             4176
## 2 basic.6y             2292
## 3 basic.9y             6045
## 4 high.school          9515
## 5 illiterate             18
## 6 professional.course  5243
## 7 university.degree   12168
## 8 unknown              1731
{% endhighlight %}



{% highlight r %}
dat %>% dist_cat(default)
{% endhighlight %}



{% highlight text %}
## # A tibble: 3 x 2
##   default     N
##   <fct>   <int>
## 1 no      32588
## 2 unknown  8597
## 3 yes         3
{% endhighlight %}



{% highlight r %}
dat %>% dist_cat(housing)
{% endhighlight %}



{% highlight text %}
## # A tibble: 3 x 2
##   housing     N
##   <fct>   <int>
## 1 no      18622
## 2 unknown   990
## 3 yes     21576
{% endhighlight %}



{% highlight r %}
dat %>% dist_cat(loan)
{% endhighlight %}



{% highlight text %}
## # A tibble: 3 x 2
##   loan        N
##   <fct>   <int>
## 1 no      33950
## 2 unknown   990
## 3 yes      6248
{% endhighlight %}



{% highlight r %}
dat %>% dist_cat(contact)
{% endhighlight %}



{% highlight text %}
## # A tibble: 2 x 2
##   contact     N
##     <int> <int>
## 1       0 15044
## 2       1 26144
{% endhighlight %}



{% highlight r %}
dat %>% dist_cat(month)
{% endhighlight %}



{% highlight text %}
## # A tibble: 10 x 2
##    month     N
##    <fct> <int>
##  1 apr    2632
##  2 aug    6178
##  3 dec     182
##  4 jul    7174
##  5 jun    5318
##  6 mar     546
##  7 may   13769
##  8 nov    4101
##  9 oct     718
## 10 sep     570
{% endhighlight %}



{% highlight r %}
dat %>% dist_cat(day_of_week)
{% endhighlight %}



{% highlight text %}
## # A tibble: 5 x 2
##   day_of_week     N
##   <fct>       <int>
## 1 fri          7827
## 2 mon          8514
## 3 thu          8623
## 4 tue          8090
## 5 wed          8134
{% endhighlight %}



{% highlight r %}
dat %>% dist_cat(poutcome)
{% endhighlight %}



{% highlight text %}
## # A tibble: 3 x 2
##   poutcome        N
##   <fct>       <int>
## 1 failure      4252
## 2 nonexistent 35563
## 3 success      1373
{% endhighlight %}



{% highlight r %}
dat %>% dist_cat(y)
{% endhighlight %}



{% highlight text %}
## # A tibble: 2 x 2
##       y     N
##   <int> <int>
## 1     0 36548
## 2     1  4640
{% endhighlight %}

続いて量的変数についてヒストグラムを描画する.  
`pdays` 以外はどの変数についても極端な外れ値は存在しない.  `pdays` については0付近か1000付近の2つのピークを取るようであり, これは分析対象のキャンペーンからその前のキャンペーンまでは接触を行っていないことに起因すると思われる.  


{% highlight r %}
n_bin <- dat %>%
    summarise(n_bin=log(n(),2)+1) %>% 
    as.numeric()
hist_num <- function(x, col){
    col <- substitute(col)
    out <- x %>% 
    ggplot(aes(x=!!col)) +
    geom_histogram(bins=n_bin)
    return(out)
}
dat %>% hist_num(age)
{% endhighlight %}

![plot of chunk dist numerics](/blog/figure/2020-02-09-AS report/dist numerics-1.png)

{% highlight r %}
dat %>% hist_num(duration)
{% endhighlight %}

![plot of chunk dist numerics](/blog/figure/2020-02-09-AS report/dist numerics-2.png)

{% highlight r %}
dat %>% hist_num(campaign)
{% endhighlight %}

![plot of chunk dist numerics](/blog/figure/2020-02-09-AS report/dist numerics-3.png)

{% highlight r %}
dat %>% hist_num(pdays)
{% endhighlight %}

![plot of chunk dist numerics](/blog/figure/2020-02-09-AS report/dist numerics-4.png)

{% highlight r %}
dat %>% hist_num(previous)
{% endhighlight %}

![plot of chunk dist numerics](/blog/figure/2020-02-09-AS report/dist numerics-5.png)

{% highlight r %}
dat %>% hist_num(emp.var.rate)
{% endhighlight %}

![plot of chunk dist numerics](/blog/figure/2020-02-09-AS report/dist numerics-6.png)

{% highlight r %}
dat %>% hist_num(cons.price.idx)
{% endhighlight %}

![plot of chunk dist numerics](/blog/figure/2020-02-09-AS report/dist numerics-7.png)

{% highlight r %}
dat %>% hist_num(cons.conf.idx)
{% endhighlight %}

![plot of chunk dist numerics](/blog/figure/2020-02-09-AS report/dist numerics-8.png)

{% highlight r %}
dat %>% hist_num(euribor3m)
{% endhighlight %}

![plot of chunk dist numerics](/blog/figure/2020-02-09-AS report/dist numerics-9.png)

{% highlight r %}
dat %>% hist_num(nr.employed)
{% endhighlight %}

![plot of chunk dist numerics](/blog/figure/2020-02-09-AS report/dist numerics-10.png)

### 目的変数に対する相関の確認

それぞれのカテゴリカル変数について, カテゴリ毎の成約回数とレコード数, それらを除算した成約率をそれぞれ示す.  
介入変数とする `contact` の他にも `job` や `education` , `month` , `poutcome` などはカテゴリ毎の成約率にばらつきがあるため, 有用な交絡変数になると思われる.  



{% highlight r %}
success_rate <- function(x, col){
    col <- substitute(col)
    out <- x %>% 
        group_by(!!col) %>% 
        summarise(n_success=sum(y == 1),
              n_count=n(),
              r_success=n_success/n_count,
              .groups="drop")
    return(out)
}
dat %>% success_rate(job)
{% endhighlight %}



{% highlight text %}
## # A tibble: 12 x 4
##    job           n_success n_count r_success
##    <fct>             <int>   <int>     <dbl>
##  1 admin.             1352   10422    0.130 
##  2 blue-collar         638    9254    0.0689
##  3 entrepreneur        124    1456    0.0852
##  4 housemaid           106    1060    0.1   
##  5 management          328    2924    0.112 
##  6 retired             434    1720    0.252 
##  7 self-employed       149    1421    0.105 
##  8 services            323    3969    0.0814
##  9 student             275     875    0.314 
## 10 technician          730    6743    0.108 
## 11 unemployed          144    1014    0.142 
## 12 unknown              37     330    0.112
{% endhighlight %}



{% highlight r %}
dat %>% success_rate(marital)
{% endhighlight %}



{% highlight text %}
## # A tibble: 4 x 4
##   marital  n_success n_count r_success
##   <fct>        <int>   <int>     <dbl>
## 1 divorced       476    4612     0.103
## 2 married       2532   24928     0.102
## 3 single        1620   11568     0.140
## 4 unknown         12      80     0.15
{% endhighlight %}



{% highlight r %}
dat %>% success_rate(education)
{% endhighlight %}



{% highlight text %}
## # A tibble: 8 x 4
##   education           n_success n_count r_success
##   <fct>                   <int>   <int>     <dbl>
## 1 basic.4y                  428    4176    0.102 
## 2 basic.6y                  188    2292    0.0820
## 3 basic.9y                  473    6045    0.0782
## 4 high.school              1031    9515    0.108 
## 5 illiterate                  4      18    0.222 
## 6 professional.course       595    5243    0.113 
## 7 university.degree        1670   12168    0.137 
## 8 unknown                   251    1731    0.145
{% endhighlight %}



{% highlight r %}
dat %>% success_rate(default)
{% endhighlight %}



{% highlight text %}
## # A tibble: 3 x 4
##   default n_success n_count r_success
##   <fct>       <int>   <int>     <dbl>
## 1 no           4197   32588    0.129 
## 2 unknown       443    8597    0.0515
## 3 yes             0       3    0
{% endhighlight %}



{% highlight r %}
dat %>% success_rate(housing)
{% endhighlight %}



{% highlight text %}
## # A tibble: 3 x 4
##   housing n_success n_count r_success
##   <fct>       <int>   <int>     <dbl>
## 1 no           2026   18622     0.109
## 2 unknown       107     990     0.108
## 3 yes          2507   21576     0.116
{% endhighlight %}



{% highlight r %}
dat %>% success_rate(loan)
{% endhighlight %}



{% highlight text %}
## # A tibble: 3 x 4
##   loan    n_success n_count r_success
##   <fct>       <int>   <int>     <dbl>
## 1 no           3850   33950     0.113
## 2 unknown       107     990     0.108
## 3 yes           683    6248     0.109
{% endhighlight %}



{% highlight r %}
dat %>% success_rate(contact)
{% endhighlight %}



{% highlight text %}
## # A tibble: 2 x 4
##   contact n_success n_count r_success
##     <int>     <int>   <int>     <dbl>
## 1       0       787   15044    0.0523
## 2       1      3853   26144    0.147
{% endhighlight %}



{% highlight r %}
dat %>% success_rate(month)
{% endhighlight %}



{% highlight text %}
## # A tibble: 10 x 4
##    month n_success n_count r_success
##    <fct>     <int>   <int>     <dbl>
##  1 apr         539    2632    0.205 
##  2 aug         655    6178    0.106 
##  3 dec          89     182    0.489 
##  4 jul         649    7174    0.0905
##  5 jun         559    5318    0.105 
##  6 mar         276     546    0.505 
##  7 may         886   13769    0.0643
##  8 nov         416    4101    0.101 
##  9 oct         315     718    0.439 
## 10 sep         256     570    0.449
{% endhighlight %}



{% highlight r %}
dat %>% success_rate(day_of_week)
{% endhighlight %}



{% highlight text %}
## # A tibble: 5 x 4
##   day_of_week n_success n_count r_success
##   <fct>           <int>   <int>     <dbl>
## 1 fri               846    7827    0.108 
## 2 mon               847    8514    0.0995
## 3 thu              1045    8623    0.121 
## 4 tue               953    8090    0.118 
## 5 wed               949    8134    0.117
{% endhighlight %}



{% highlight r %}
dat %>% success_rate(poutcome)
{% endhighlight %}



{% highlight text %}
## # A tibble: 3 x 4
##   poutcome    n_success n_count r_success
##   <fct>           <int>   <int>     <dbl>
## 1 failure           605    4252    0.142 
## 2 nonexistent      3141   35563    0.0883
## 3 success           894    1373    0.651
{% endhighlight %}

続いて, それぞれの量的変数について目的変数 `y` に対する相関係数を表示する.  
`pdays` や `previous` などの前回キャンペーンの結果や, `euribor3m` や `nr.employed` などの景気動向との相が特に高いことが見て取れる.  
より詳しい情報として, それぞれの量的変数について目的変数 `y` の値別の箱ひげ図を付録に示す. 


{% highlight r %}
success_cor <- function(x, col){
    col <- substitute(col)
    tmp <- x %>% 
        mutate(y_01 = (y == 1) %>% as.integer(), .before=1) %>% 
        dplyr::select(y_01, !!col)
    out <- cor(tmp)
    return(out[1,2])
}

success_scat <- function(x, col){
    col <- substitute(col)
    out <- x %>% 
        mutate(y_01 = (y == 1) %>% as.integer(), .before=1) %>% 
        ggplot(aes(x=!!col, y=y_01)) +
        geom_point() + 
        ylab("y")
    return(out)
}
success_box <- function(x, col){
    col <- substitute(col)
    out <- x %>% 
        mutate(y_01 = (y == 1) %>% as.integer(), .before=1) %>% 
        ggplot(aes(y=!!col, x=y_01 %>% as.factor())) +
        geom_boxplot() + 
        xlab("y")
    return(out)
}

dat %>% 
    dplyr::select(y,age, duration, campaign, pdays, previous, emp.var.rate,cons.price.idx,cons.conf.idx,euribor3m,nr.employed) %>% 
    cor() %>% 
    data.frame() %>% 
    mutate(variable=rownames(.)) %>% 
    dplyr::select(variable,y) 
{% endhighlight %}



{% highlight text %}
##          variable           y
## 1               y  1.00000000
## 2             age  0.03039880
## 3        duration  0.40527380
## 4        campaign -0.06635741
## 5           pdays -0.32491448
## 6        previous  0.23018100
## 7    emp.var.rate -0.29833443
## 8  cons.price.idx -0.13621121
## 9   cons.conf.idx  0.05487795
## 10      euribor3m -0.30777140
## 11    nr.employed -0.35467830
{% endhighlight %}


# 分析

## 問題設定

`contact` は `cellular` と `telephon` の2種類があり, その選択によって定期預金の成約率が変わる可能性がある. そこで, 因果推論に基づいて `contact` による成約率向上の効果の有無を検証する.

分析は以下の3つのロジスティック回帰モデルによって `contact` の `y` に対する回帰係数を求め, 有意性や効果量を評価する.  

$$
\begin{eqnarray*}
Model\ M1 :\\
logit(p_i) &=& \beta_0 + \beta_1 contact_i \\
Model\ M2 :\\
logit(p_i) &=& \beta_0 + \beta_1 contact_i + \sum_k\beta_k X_{ik} \\
Model\ M3 :\\
logit(p_i) &=& \beta_0 + \beta_1 contact_i + \beta_2 P(X_i) \\
logit\left(P(X_i)\right) &=& \gamma_0 + \sum_k\gamma_k X_{ik}\\
\end{eqnarray*}
$$

ここで, $i$は観測対象, $p_i$は観測対象$i$の成約格率, $\beta_0$と$\gamma_0$は定数, $\beta_1$は$contact$の$y$に対する効果量, $concact_i$は$i$番目の観測対象に対して携帯電話への接触を行った場合に1となる変数, $\beta_k$は$k$番目の交絡変数の$y$に対する回帰係数, $X_{ik}$は$k$番目の交絡変数, $P(X_i)$は$i$番目の観測対象へ境内電話への接触を行う確率(傾向スコア), $\gamma_k$は$k$番目の交絡変数の$P(X_i)$に対する回帰係数である.  
交絡変数は, $y$と$contact$と$duration$を除く全ての変数とする. 

## 分析結果

まず, 傾向スコアの推定を行った結果を示す.  
回帰係数の推定結果は付録とし, `contact` の値別の傾向スコア推定値のヒストグラムとROC曲線を以下に示す. 


{% highlight r %}
model_pscore <- glm(contact ~ age + job + marital + education + default + housing + loan + month + day_of_week + campaign + pdays + previous + poutcome,
                    family = binomial("logit"), data=dat)
# list("Model pscore"=model_pscore) %>% msummary(stars=TRUE)

ps <- model_pscore$fitted.values %>% 
    as_tibble() %>% 
    rename(pscore=value) %>% 
    mutate(idx=rownames(.), .before=1)
dat2 <- dat %>% 
    mutate(idx=rownames(.), .before=1) %>% 
    left_join(ps, by="idx")
dat2 %>%
    ggplot(aes(x=pscore, fill=contact %>% as.factor())) +
    geom_histogram(position="identity", alpha=0.8) +
    labs(fill="contact")
{% endhighlight %}

![plot of chunk pscore](/blog/figure/2020-02-09-AS report/pscore-1.png)

{% highlight r %}
# dat2 %>% 
#     ggplot(aes(x=pscore, y=contact)) + 
#     geom_point()

ROC1 = roc(contact ~ pscore, data=dat2, ci=TRUE)
# ROC1$auc %>% format(digits=3)
# plot(ROC1, legacy.axes=TRUE)
ROC1_res <- ROC1$sensitivities %>% 
    bind_cols(ROC1$specificities) %>% 
    rename(specificities=`...1`, sensitivities=`...2`)
ROC1_res %>% 
    ggplot(aes(x=1-specificities, y=sensitivities)) +
    geom_line() +
    geom_abline(intercept = 0, slope = 1, size=0.1) +
    coord_fixed() + 
    xlim(0,1) + ylim(0,1) + 
    annotate("text",label=paste("AUC :",ROC1$auc %>% format(digits=3)),
             x=0.75, y=0.25)
{% endhighlight %}

![plot of chunk pscore](/blog/figure/2020-02-09-AS report/pscore-2.png)

ヒストグラムより, 傾向スコアの大半の領域にて `contact` 変数のいずれの値も存在するため, 傾向スコアとして適度な分類がなされていると判断できる.  
また, ROC曲線より, c統計量(AUC)は0.88と十分な識別能力を持っていることが確認できる. 

続いて, 上記推定された傾向スコアを利用して, Model M1からM3の3つのモデルによって `contact` の効果を推定した結果を示す. 尚, 交絡因子の回帰係数の推定結果については付録にて示す. 


{% highlight r %}
model_sreg <- glm(y ~ contact,
                  family = binomial("logit"), data=dat2)
model_mreg <- glm(y ~ contact + age + job + marital + education + default + housing + loan + month + day_of_week + campaign + pdays + previous + poutcome,
                    family = binomial("logit"), data=dat2)
model_preg <- glm(y ~ contact + pscore, family = binomial("logit"), data=dat2)


list(
    "model M1"=model_sreg,
    "model M2"=model_mreg,
    "model M3"=model_preg
) %>% msummary(stars=TRUE,
               coef_omit="age|job|marital|education|default|housing|loan|month|day|campaign|pdays|previous|poutcome")
{% endhighlight %}

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> model M1 </th>
   <th style="text-align:center;"> model M2 </th>
   <th style="text-align:center;"> model M3 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> -2.897*** </td>
   <td style="text-align:center;"> -1.330*** </td>
   <td style="text-align:center;"> -3.084*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.037) </td>
   <td style="text-align:center;"> (0.280) </td>
   <td style="text-align:center;"> (0.045) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> contact </td>
   <td style="text-align:center;"> 1.141*** </td>
   <td style="text-align:center;"> 0.948*** </td>
   <td style="text-align:center;"> 0.901*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.041) </td>
   <td style="text-align:center;"> (0.052) </td>
   <td style="text-align:center;"> (0.052) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> pscore </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.526*** </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.071) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 41188 </td>
   <td style="text-align:center;"> 41188 </td>
   <td style="text-align:center;"> 41188 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 28043.4 </td>
   <td style="text-align:center;"> 24204.1 </td>
   <td style="text-align:center;"> 27989.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 28060.6 </td>
   <td style="text-align:center;"> 24609.5 </td>
   <td style="text-align:center;"> 28015.1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> -14019.698 </td>
   <td style="text-align:center;"> -12055.025 </td>
   <td style="text-align:center;"> -13991.616 </td>
  </tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup></sup> * p &lt; 0.1, ** p &lt; 0.05, *** p &lt; 0.01</td>
</tr>
</tfoot>
</table>



{% highlight r %}
# model_preg$coefficients[2] %>% exp() # オッズ比
{% endhighlight %}

## 考察

いずれのモデルについても, `contact` の `y` に対する効果は1%の有意水準で存在すると示された.  

model M1 は単回帰であり, 交絡因子の不在によるバイアスが存在するため, 効果が過剰に見積もられている.  
model M2 と model M3 はどちらもモデル全体で使用する変数は共通しているにも関わらず, 効果量の推定値は標準誤差に比べて M2 の方がやや大きい. これについての解釈は複数考えられるが, 例えば M2 では目的変数の対数オッズに対する交絡変数の関係が線形であると仮定しているが, 例えば `age` などの数値が目的変数に非線形な影響を与えるなどの現象がモデル化されていないことによるバイアスが存在する可能性などが考えられる. 

# 結論

上記の考察により最も妥当であると思われる model M3 について, `contact` のオッズ比を求めると2.46となる. すなわち, 電話営業の手段を携帯電話への連絡とすることで, 成約率が2倍になると見積もられた. 

ただし中止なければいけないのは, 今回のデータには真の意味での非介入群のデータ, すなわち電話営業を行っていない顧客のデータがないため, そもそも電話営業を行うかどうかによる選択バイアスは考慮できていない. また, 得られたデータに交絡要因が全て入っている訳ではなく, 例えば口座の残高など効果に影響しそうな要因は他にも考えられるためバイアスを全て除去できているとは限らない. 

# 付録

## 箱ひげ図


{% highlight r %}
# # 重いから最後だけ実行 ----
dat %>% success_box(age)
{% endhighlight %}

![plot of chunk box](/blog/figure/2020-02-09-AS report/box-1.png)

{% highlight r %}
dat %>% success_box(duration)
{% endhighlight %}

![plot of chunk box](/blog/figure/2020-02-09-AS report/box-2.png)

{% highlight r %}
dat %>% success_box(campaign)
{% endhighlight %}

![plot of chunk box](/blog/figure/2020-02-09-AS report/box-3.png)

{% highlight r %}
dat %>% success_box(pdays)
{% endhighlight %}

![plot of chunk box](/blog/figure/2020-02-09-AS report/box-4.png)

{% highlight r %}
dat %>% success_box(previous)
{% endhighlight %}

![plot of chunk box](/blog/figure/2020-02-09-AS report/box-5.png)

{% highlight r %}
dat %>% success_box(emp.var.rate)
{% endhighlight %}

![plot of chunk box](/blog/figure/2020-02-09-AS report/box-6.png)

{% highlight r %}
dat %>% success_box(cons.price.idx)
{% endhighlight %}

![plot of chunk box](/blog/figure/2020-02-09-AS report/box-7.png)

{% highlight r %}
dat %>% success_box(cons.conf.idx)
{% endhighlight %}

![plot of chunk box](/blog/figure/2020-02-09-AS report/box-8.png)

{% highlight r %}
dat %>% success_box(euribor3m)
{% endhighlight %}

![plot of chunk box](/blog/figure/2020-02-09-AS report/box-9.png)

{% highlight r %}
dat %>% success_box(nr.employed)
{% endhighlight %}

![plot of chunk box](/blog/figure/2020-02-09-AS report/box-10.png)

## 傾向スコアの回帰係数


{% highlight r %}
list("Model pscore"=model_pscore) %>% msummary(stars=TRUE)
{% endhighlight %}

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> Model pscore </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> 4.747*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.459) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> age </td>
   <td style="text-align:center;"> -0.006*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.002) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobblue-collar </td>
   <td style="text-align:center;"> 0.097* </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.050) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobentrepreneur </td>
   <td style="text-align:center;"> -0.133* </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.079) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobhousemaid </td>
   <td style="text-align:center;"> -0.222** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.095) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobmanagement </td>
   <td style="text-align:center;"> -0.016 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.061) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobretired </td>
   <td style="text-align:center;"> 0.156* </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.087) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobself-employed </td>
   <td style="text-align:center;"> -0.117 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.081) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobservices </td>
   <td style="text-align:center;"> -0.022 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.054) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobstudent </td>
   <td style="text-align:center;"> 0.301*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.111) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobtechnician </td>
   <td style="text-align:center;"> -0.059 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.052) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobunemployed </td>
   <td style="text-align:center;"> -0.159* </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.095) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobunknown </td>
   <td style="text-align:center;"> -0.264* </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.160) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> maritalmarried </td>
   <td style="text-align:center;"> -0.023 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.045) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> maritalsingle </td>
   <td style="text-align:center;"> 0.237*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.052) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> maritalunknown </td>
   <td style="text-align:center;"> 0.552* </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.323) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationbasic.6y </td>
   <td style="text-align:center;"> 0.060 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.070) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationbasic.9y </td>
   <td style="text-align:center;"> 0.067 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.056) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationhigh.school </td>
   <td style="text-align:center;"> 0.078 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.059) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationilliterate </td>
   <td style="text-align:center;"> 0.579 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.783) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationprofessional.course </td>
   <td style="text-align:center;"> 0.066 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.068) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationuniversity.degree </td>
   <td style="text-align:center;"> 0.143** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.061) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationunknown </td>
   <td style="text-align:center;"> -0.158* </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.082) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> defaultunknown </td>
   <td style="text-align:center;"> -0.454*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.035) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> defaultyes </td>
   <td style="text-align:center;"> 7.186 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (66.905) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> housingunknown </td>
   <td style="text-align:center;"> -0.023 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.091) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> housingyes </td>
   <td style="text-align:center;"> 0.255*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.028) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> loanunknown </td>
   <td style="text-align:center;"> NA </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> () </td>
  </tr>
  <tr>
   <td style="text-align:left;"> loanyes </td>
   <td style="text-align:center;"> 0.051 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.039) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthaug </td>
   <td style="text-align:center;"> 0.958*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.100) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthdec </td>
   <td style="text-align:center;"> -1.427*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.223) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthjul </td>
   <td style="text-align:center;"> -0.351*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.085) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthjun </td>
   <td style="text-align:center;"> -4.097*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.088) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthmar </td>
   <td style="text-align:center;"> -0.630*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.161) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthmay </td>
   <td style="text-align:center;"> -2.895*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.080) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthnov </td>
   <td style="text-align:center;"> -0.325*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.094) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthoct </td>
   <td style="text-align:center;"> -1.649*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.126) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthsep </td>
   <td style="text-align:center;"> -1.302*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.147) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> day_of_weekmon </td>
   <td style="text-align:center;"> 0.235*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.044) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> day_of_weekthu </td>
   <td style="text-align:center;"> 0.139*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.044) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> day_of_weektue </td>
   <td style="text-align:center;"> 0.059 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.044) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> day_of_weekwed </td>
   <td style="text-align:center;"> 0.009 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.044) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> campaign </td>
   <td style="text-align:center;"> -0.062*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.005) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> pdays </td>
   <td style="text-align:center;"> 0.000 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.000) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> previous </td>
   <td style="text-align:center;"> -0.107 </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.097) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poutcomenonexistent </td>
   <td style="text-align:center;"> -2.782*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.126) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poutcomesuccess </td>
   <td style="text-align:center;"> 0.108 </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.392) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 41188 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 33280.9 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 33677.7 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> -16594.454 </td>
  </tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup></sup> * p &lt; 0.1, ** p &lt; 0.05, *** p &lt; 0.01</td>
</tr>
</tfoot>
</table>

## 交絡因子を含めたyの回帰係数


{% highlight r %}
list(
    "model M1"=model_sreg,
    "model M2"=model_mreg,
    "model M3"=model_preg
) %>% msummary(stars=TRUE)
{% endhighlight %}

<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:center;"> model M1 </th>
   <th style="text-align:center;"> model M2 </th>
   <th style="text-align:center;"> model M3 </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> (Intercept) </td>
   <td style="text-align:center;"> -2.897*** </td>
   <td style="text-align:center;"> -1.330*** </td>
   <td style="text-align:center;"> -3.084*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.037) </td>
   <td style="text-align:center;"> (0.280) </td>
   <td style="text-align:center;"> (0.045) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> contact </td>
   <td style="text-align:center;"> 1.141*** </td>
   <td style="text-align:center;"> 0.948*** </td>
   <td style="text-align:center;"> 0.901*** </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;"> (0.041) </td>
   <td style="text-align:center;"> (0.052) </td>
   <td style="text-align:center;"> (0.052) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> age </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.005*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.002) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobblue-collar </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.234*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.067) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobentrepreneur </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.180* </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.105) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobhousemaid </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.087 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.123) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobmanagement </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.127* </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.073) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobretired </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.486*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.090) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobself-employed </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.100 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.099) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobservices </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.199*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.073) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobstudent </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.607*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.098) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobtechnician </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.128** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.060) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobunemployed </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.079 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.108) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> jobunknown </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.120 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.208) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> maritalmarried </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.076 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.058) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> maritalsingle </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.219*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.066) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> maritalunknown </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.269 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.363) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationbasic.6y </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.087 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.102) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationbasic.9y </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.063 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.081) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationhigh.school </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.024 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.078) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationilliterate </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.994 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.614) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationprofessional.course </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.052 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.087) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationuniversity.degree </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.146* </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.079) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> educationunknown </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.203** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.102) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> defaultunknown </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.541*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.056) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> defaultyes </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -9.360 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (113.685) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> housingunknown </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.056 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.117) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> housingyes </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.014 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.035) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> loanunknown </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> NA </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> () </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> loanyes </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.046 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.049) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthaug </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.846*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.069) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthdec </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.856*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.176) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthjul </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.732*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.068) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthjun </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.023 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.078) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthmar </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 1.127*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.106) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthmay </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.774*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.065) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthnov </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.908*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.075) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthoct </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.684*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.100) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> monthsep </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.510*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.111) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> day_of_weekmon </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.183*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.056) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> day_of_weekthu </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.037 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.054) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> day_of_weektue </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.058 </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.056) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> day_of_weekwed </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.108* </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.055) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> campaign </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.072*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.009) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> pdays </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> -0.001*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.000) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> previous </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.191*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.056) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poutcomenonexistent </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.291*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.086) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> poutcomesuccess </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.794*** </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> (0.200) </td>
   <td style="text-align:center;">  </td>
  </tr>
  <tr>
   <td style="text-align:left;"> pscore </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;">  </td>
   <td style="text-align:center;"> 0.526*** </td>
  </tr>
  <tr>
   <td style="text-align:left;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px">  </td>
   <td style="text-align:center;box-shadow: 0px 1px"> (0.071) </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Num.Obs. </td>
   <td style="text-align:center;"> 41188 </td>
   <td style="text-align:center;"> 41188 </td>
   <td style="text-align:center;"> 41188 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> AIC </td>
   <td style="text-align:center;"> 28043.4 </td>
   <td style="text-align:center;"> 24204.1 </td>
   <td style="text-align:center;"> 27989.2 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> BIC </td>
   <td style="text-align:center;"> 28060.6 </td>
   <td style="text-align:center;"> 24609.5 </td>
   <td style="text-align:center;"> 28015.1 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Log.Lik. </td>
   <td style="text-align:center;"> -14019.698 </td>
   <td style="text-align:center;"> -12055.025 </td>
   <td style="text-align:center;"> -13991.616 </td>
  </tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%">
<sup></sup> * p &lt; 0.1, ** p &lt; 0.05, *** p &lt; 0.01</td>
</tr>
</tfoot>
</table>

----
以上
